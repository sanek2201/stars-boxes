<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Stars Boxes</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #fff;
      text-align: center;
    }
    h1 { margin: 16px 0; }
    .score, .limit {
      font-size: 18px;
      margin-bottom: 6px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      padding: 20px;
    }
    .box {
      background: #1e293b;
      border-radius: 12px;
      height: 90px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      cursor: pointer;
      user-select: none;
    }
    .box.opened {
      background: #020617;
      cursor: default;
    }
    .box.rare {
      border: 2px solid gold;
      box-shadow: 0 0 10px gold;
    }
    .disabled {
      opacity: 0.5;
      pointer-events: none;
    }
  </style>
</head>
<body>

<h1>üéÅ Stars Boxes</h1>
<div class="score">–û—á–∫–∏: <span id="points">0</span></div>
<div class="limit">–û—Å—Ç–∞–ª–æ—Å—å —Å–µ–≥–æ–¥–Ω—è: <span id="left">3</span>/3</div>

<div class="grid" id="grid"></div>

<script>
  const tg = window.Telegram.WebApp;
  tg.ready();

  const MAX_PER_DAY = 3;
  const today = new Date().toDateString();

  let points = Number(localStorage.getItem("points") || 0);
  let openedToday = Number(localStorage.getItem("openedToday") || 0);
  let lastDate = localStorage.getItem("lastDate");

  if (lastDate !== today) {
    openedToday = 0;
    localStorage.setItem("openedToday", 0);
    localStorage.setItem("lastDate", today);
  }

  document.getElementById("points").innerText = points;
  document.getElementById("left").innerText = MAX_PER_DAY - openedToday;

  const grid = document.getElementById("grid");

  function createBoxes() {
    grid.innerHTML = "";
    for (let i = 0; i < 9; i++) {
      const box = document.createElement("div");
      box.className = "box";
      box.innerText = "üì¶";

      if (Math.random() < 0.01) {
        box.classList.add("rare");
      }

      if (openedToday >= MAX_PER_DAY) {
        box.classList.add("disabled");
      } else {
        box.onclick = () => openBox(box);
      }

      grid.appendChild(box);
    }
  }

  function openBox(box) {
    if (box.classList.contains("opened")) return;
    if (openedToday >= MAX_PER_DAY) return;

    box.classList.add("opened");
    openedToday++;
    localStorage.setItem("openedToday", openedToday);

    let rewardText = "‚ùå";

    if (box.classList.contains("rare")) {
      points += 200;
      rewardText = "üíé +200";
    } else {
      const rand = Math.random();
      if (rand < 0.6) {
        const gain = Math.floor(Math.random() * 10) + 1;
        points += gain;
        rewardText = `‚≠ê +${gain}`;
      } else if (rand < 0.9) {
        rewardText = "‚ùå";
      } else {
        points += 50;
        rewardText = "üéÅ +50";
      }
    }

    box.innerText = rewardText;
    localStorage.setItem("points", points);
    document.getElementById("points").innerText = points;
    document.getElementById("left").innerText = MAX_PER_DAY - openedToday;

    if (openedToday >= MAX_PER_DAY) {
      createBoxes();
    }
  }

  createBoxes();
</script>

</body>
</html>
